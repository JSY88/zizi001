<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuizFlow - Cloud & Dark</title>
  <style>
    /* 1. ìƒ‰ìƒ ë³€ìˆ˜ ì •ì˜ (ê¸°ë³¸ Light) */
    :root { 
      --primary: #2563eb; 
      --danger: #ef4444; 
      --bg: #f8fafc; 
      --card: #ffffff; 
      --text: #1e293b; 
      --sub: #64748b; 
      --border: #cbd5e1;
      --input-bg: #ffffff;
    }

    /* 2. ë‹¤í¬ ëª¨ë“œ ì˜¤ë²„ë¼ì´ë“œ (í•µì‹¬) */
    body.dark-mode {
      --primary: #3b82f6; /* ì¡°ê¸ˆ ë” ë°ì€ ë¸”ë£¨ */
      --danger: #f87171;
      --bg: #0f172a;      /* ì•„ì£¼ ì–´ë‘ìš´ ë‚¨ìƒ‰ */
      --card: #1e293b;    /* ì–´ë‘ìš´ íšŒìƒ‰ */
      --text: #f1f5f9;    /* ë°ì€ í°ìƒ‰ */
      --sub: #94a3b8;     /* ì—°í•œ íšŒìƒ‰ */
      --border: #334155;  /* ì–´ë‘ìš´ í…Œë‘ë¦¬ */
      --input-bg: #0f172a;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { background: var(--bg); color: var(--text); padding: 20px; max-width: 600px; margin: 0 auto; line-height: 1.5; padding-bottom: 80px; transition: background 0.3s, color 0.3s; }
    
    /* ë²„íŠ¼ ê³µí†µ */
    .btn { padding: 8px 16px; border-radius: 8px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: 4px; }
    .btn:hover { background: var(--bg); transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2); }
    .btn-primary:hover { background: var(--primary); opacity: 0.9; }
    .btn-icon { padding: 8px; color: var(--sub); border: none; background: transparent; border-radius: 50%; }
    .btn-icon:hover { color: var(--text); background: var(--bg); }

    /* í…Œë§ˆ í† ê¸€ ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) */
    .theme-btn { position: absolute; top: 20px; right: 20px; font-size: 20px; background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; transition: 0.2s; }
    .theme-btn:hover { background: var(--border); }

    /* í† ê¸€ ìŠ¤ìœ„ì¹˜ (ì˜¤ë‹µ ë…¸íŠ¸) */
    .toggle-wrapper { display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
    .toggle-switch { position: relative; width: 44px; height: 24px; background: var(--border); border-radius: 12px; transition: 0.3s; }
    .toggle-switch::after { content: ''; position: absolute; left: 2px; top: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: 0.3s; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    .toggle-input:checked + .toggle-wrapper .toggle-switch { background: var(--danger); }
    .toggle-input:checked + .toggle-wrapper .toggle-switch::after { transform: translateX(20px); }
    .toggle-input { display: none; }
    .toggle-label { font-size: 14px; font-weight: 600; color: var(--sub); }
    .toggle-input:checked + .toggle-wrapper .toggle-label { color: var(--danger); }

    /* í†µê³„ ì¹´ë“œ */
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px; }
    .stat-card { background: var(--card); padding: 16px; border-radius: 12px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid var(--border); }
    .stat-val { font-size: 24px; font-weight: 800; color: var(--primary); margin-bottom: 4px; }
    .stat-label { font-size: 12px; color: var(--sub); font-weight: 500; }

    /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
    .list-container { display: flex; flex-direction: column; gap: 12px; }
    .list-item { 
      background: var(--card); border-radius: 12px; padding: 16px; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.05); border: 1px solid var(--border); 
      display: flex; align-items: center; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden;
    }
    .list-item:hover { border-color: var(--primary); transform: translateY(-2px); }
    .list-item.selected { border-color: var(--primary); background: rgba(37, 99, 235, 0.1); }
    
    .select-check { margin-right: 12px; width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; flex-shrink: 0; }
    .list-item.selected .select-check { background: var(--primary); border-color: var(--primary); }
    .list-item.selected .select-check::after { content: 'âœ”'; color: white; font-size: 12px; }

    .item-info { flex: 1; min-width: 0; }
    .item-info h3 { font-size: 16px; margin-bottom: 4px; font-weight: 700; color: var(--text); }
    .item-info p { font-size: 13px; color: var(--sub); }
    .item-actions { display: flex; gap: 4px; align-items: center; }

    /* í€´ì¦ˆ í™”ë©´ */
    .quiz-card { background: var(--card); padding: 24px; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); margin-top: 10px; border: 1px solid var(--border); }
    .question-badge { display: inline-block; padding: 4px 12px; background: var(--bg); color: var(--sub); font-size: 12px; font-weight: 600; border-radius: 20px; margin-bottom: 12px; border: 1px solid var(--border); }
    .question-text { font-size: 19px; font-weight: 700; margin-bottom: 24px; line-height: 1.4; color: var(--text); }
    .option-btn { 
      display: block; width: 100%; text-align: left; padding: 16px; margin-bottom: 10px; 
      border: 2px solid var(--border); border-radius: 10px; background: var(--card); color: var(--text);
      cursor: pointer; font-size: 15px; font-weight: 500; transition: all 0.2s;
    }
    .option-btn:hover { border-color: var(--primary); background: var(--bg); }
    .option-btn.correct { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; color: #15803d; }
    body.dark-mode .option-btn.correct { color: #86efac; } /* ë‹¤í¬ëª¨ë“œì—ì„œ ì´ˆë¡ìƒ‰ ê°€ë…ì„± ì¡°ì • */
    .option-btn.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--danger); color: #b91c1c; }
    body.dark-mode .option-btn.wrong { color: #fca5a5; }

    /* í”Œë¡œíŒ… ë°” & ëª¨ë‹¬ */
    .bottom-bar { 
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%); 
      background: var(--text); color: var(--bg); padding: 12px 24px; border-radius: 50px; 
      box-shadow: 0 4px 20px rgba(0,0,0,0.3); display: flex; gap: 16px; align-items: center; z-index: 50; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
    }
    .bottom-bar.active { transform: translateX(-50%) translateY(0); }

    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; z-index: 100; backdrop-filter: blur(2px); }
    .modal.active { display: flex; }
    .modal-box { background: var(--card); padding: 24px; border-radius: 16px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3); }
    .input-group label { display: block; font-size: 13px; font-weight: 600; margin-bottom: 6px; color: var(--text); }
    .input-field { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: var(--input-bg); color: var(--text); transition: 0.2s; }
    .input-field:focus { outline: none; border-color: var(--primary); }
    
    .empty-state { text-align: center; padding: 60px 0; color: var(--sub); }
  </style>
</head>
<body>
  <div id="app"></div>
  <div id="modal" class="modal"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

    // ì„¤ì •ê°’ (ê¸°ì¡´ ìœ ì§€)
    const firebaseConfig = {
      apiKey: "AIzaSyDdHzcvkQMeJCNo6OZWrr06q1oMH5xvSiI",
      authDomain: "my-quiz-app-b5e97.firebaseapp.com",
      projectId: "my-quiz-app-b5e97",
      storageBucket: "my-quiz-app-b5e97.firebasestorage.app",
      messagingSenderId: "1095263157286",
      appId: "1:1095263157286:web:03e507d491423fcb9c3ae7",
      measurementId: "G-H4NGN70E5S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // --- DB Logic ---
    let USER_KEY = localStorage.getItem('quiz_user_key');
    if (!USER_KEY) {
      USER_KEY = prompt("ë°ì´í„°ë¥¼ ê³µìœ í•  ë‚˜ë§Œì˜ ë‹‰ë„¤ì„(ID)ì„ ì…ë ¥í•˜ì„¸ìš”.\n(ì˜ˆ: myname123)", "guest");
      if(!USER_KEY) USER_KEY = "guest";
      localStorage.setItem('quiz_user_key', USER_KEY);
    }

    window.DB = {
      data: { folders: [{ id: 'def', name: 'ê¸°ë³¸ í´ë”' }], quizzes: [], results: [] },
      async load() {
        try {
          const docRef = doc(db, "quiz_users", USER_KEY);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) { this.data = docSnap.data(); console.log(`[${USER_KEY}] ë¡œë“œ ì™„ë£Œ`); } 
          else { this.save(); }
        } catch (e) { alert("ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: " + e.message); }
      },
      async save() {
        try { await setDoc(doc(db, "quiz_users", USER_KEY), this.data); if(window.App) window.App.render(); } 
        catch (e) { console.error("ì €ì¥ ì‹¤íŒ¨", e); }
      },
      getWrongIndices(quizId) {
        const lastResults = {};
        if(!this.data.results) return [];
        this.data.results.filter(r => r.quizId === quizId).forEach(r => {
            if (!lastResults[r.qId] || lastResults[r.qId].date < r.date) lastResults[r.qId] = r;
        });
        return Object.values(lastResults).filter(r => !r.correct).map(r => r.qId);
      }
    };

    // --- App Logic ---
    window.App = {
      state: {
        view: 'home', currentFolderId: null, currentQuiz: null, qIndex: 0, answers: [],
        reviewMode: false, selectMode: false, selectedQuizIds: [],
        isDarkMode: localStorage.getItem('quiz_theme') === 'dark'
      },

      // í…Œë§ˆ í† ê¸€ í•¨ìˆ˜
      toggleTheme() {
        this.state.isDarkMode = !this.state.isDarkMode;
        if (this.state.isDarkMode) {
          document.body.classList.add('dark-mode');
          localStorage.setItem('quiz_theme', 'dark');
        } else {
          document.body.classList.remove('dark-mode');
          localStorage.setItem('quiz_theme', 'light');
        }
        this.render(); // ì•„ì´ì½˜ ë³€ê²½ì„ ìœ„í•´ ë Œë”ë§
      },

      goHome() { this.state.view = 'home'; this.state.currentFolderId = null; this.state.selectMode = false; this.state.selectedQuizIds = []; this.render(); },
      goToList(folderId) { this.state.view = 'list'; this.state.currentFolderId = folderId; this.state.selectMode = false; this.state.selectedQuizIds = []; this.render(); },

      startQuiz(quizId) {
        if (this.state.selectMode) return;
        const originalQuiz = window.DB.data.quizzes.find(q => q.id === quizId);
        if (!originalQuiz) return;

        let targetQuestions = originalQuiz.questions;
        let isFiltered = false;

        if (this.state.reviewMode) {
          const wrongIndices = window.DB.getWrongIndices(quizId);
          if (wrongIndices.length === 0) { alert("í‹€ë¦° ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤! ğŸ‰"); return; }
          targetQuestions = originalQuiz.questions.map((q, idx) => ({ ...q, _originalIndex: idx })).filter(q => wrongIndices.includes(q._originalIndex));
          isFiltered = true;
        } else {
          targetQuestions = originalQuiz.questions.map((q, idx) => ({ ...q, _originalIndex: idx }));
        }

        this.state.currentQuiz = { ...originalQuiz, questions: targetQuestions, isFiltered };
        this.state.view = 'quiz';
        this.state.qIndex = 0;
        this.state.answers = [];
        this.render();
      },

      addFolder() { const name = prompt('ìƒˆ í´ë” ì´ë¦„:'); if (name) { window.DB.data.folders.push({ id: Date.now().toString(), name }); window.DB.save(); } },
      renameFolder(e, id) { e.stopPropagation(); const f = window.DB.data.folders.find(f => f.id === id); const name = prompt('ìˆ˜ì •í•  ì´ë¦„:', f.name); if(name){ f.name = name; window.DB.save(); } },
      deleteFolder(e, id) { e.stopPropagation(); if(confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { window.DB.data.folders = window.DB.data.folders.filter(f => f.id !== id); window.DB.data.quizzes = window.DB.data.quizzes.filter(q => q.folderId !== id); window.DB.save(); } },
      
      renameQuiz(e, qId) { e.stopPropagation(); const q = window.DB.data.quizzes.find(q => q.id === qId); const name = prompt('ìˆ˜ì •í•  ì œëª©:', q.title); if(name){ q.title = name; window.DB.save(); } },
      deleteQuiz(e, id) { e.stopPropagation(); if(confirm('ì‚­ì œ?')) { window.DB.data.quizzes = window.DB.data.quizzes.filter(q => q.id !== id); window.DB.save(); } },

      toggleSelectMode() { this.state.selectMode = !this.state.selectMode; this.state.selectedQuizIds = []; this.render(); },
      toggleSelection(id) { const ids = this.state.selectedQuizIds; this.state.selectedQuizIds = ids.includes(id) ? ids.filter(x => x !== id) : [...ids, id]; this.render(); },
      
      mergeSelectedQuizzes() {
        const ids = this.state.selectedQuizIds;
        if (ids.length < 2) { alert('2ê°œ ì´ìƒ ì„ íƒí•˜ì„¸ìš”.'); return; }
        const newName = prompt('ë³‘í•©ëœ í€´ì¦ˆ ì œëª©:', 'ë³‘í•©ëœ í€´ì¦ˆ');
        if (!newName) return;
        const targetQuizzes = window.DB.data.quizzes.filter(q => ids.includes(q.id));
        let mergedQuestions = [];
        targetQuizzes.forEach(q => { mergedQuestions = [...mergedQuestions, ...q.questions]; });
        window.DB.data.quizzes.push({ id: Math.random().toString(36).substr(2, 9), folderId: this.state.currentFolderId, title: newName, questions: mergedQuestions });
        if (confirm('ì›ë³¸ í€´ì¦ˆë¥¼ ì‚­ì œí• ê¹Œìš”?')) { window.DB.data.quizzes = window.DB.data.quizzes.filter(q => !ids.includes(q.id)); }
        this.state.selectMode = false; this.state.selectedQuizIds = []; window.DB.save();
      },

      addQuizModal() {
        const folders = window.DB.data.folders;
        const currentId = this.state.currentFolderId;
        const modalHtml = `
          <div class="modal-box">
            <h2 style="margin-bottom:16px; font-size:18px; font-weight:bold; color:var(--text);">í€´ì¦ˆ ì¶”ê°€</h2>
            <div class="input-group"><label>í´ë”</label><select id="m_folder" class="input-field">${folders.map(f => `<option value="${f.id}" ${f.id === currentId ? 'selected' : ''}>${f.name}</option>`).join('')}</select></div>
            <div class="input-group"><label>ì œëª©</label><input id="m_title" type="text" class="input-field" placeholder="ì˜ˆ: ì˜ë‹¨ì–´ day1"></div>
            <div class="input-group"><label>ë°ì´í„° (JSON)</label><textarea id="m_json" class="input-field" style="height:120px; font-family:monospace;" placeholder='[{"q":"ì§ˆë¬¸","options":["A","B"],"correct":0}]'></textarea></div>
            <div style="display:flex; gap:8px; margin-top:24px;">
              <button onclick="document.getElementById('modal').classList.remove('active')" class="btn" style="flex:1">ì·¨ì†Œ</button>
              <button onclick="window.App.saveQuizData()" class="btn btn-primary" style="flex:1">ì €ì¥</button>
            </div>
          </div>`;
        const modal = document.getElementById('modal'); modal.innerHTML = modalHtml; modal.classList.add('active');
      },

      saveQuizData() {
        try {
          const folderId = document.getElementById('m_folder').value;
          const title = document.getElementById('m_title').value.trim();
          const data = JSON.parse(document.getElementById('m_json').value);
          let newQuizzes = [];
          if (Array.isArray(data) && data[0].questions) newQuizzes = data.map(q => ({ id: Math.random().toString(36).substr(2, 9), folderId, title: q.title || title || 'ì œëª© ì—†ìŒ', questions: q.questions }));
          else if (Array.isArray(data)) { if (!title) throw new Error("ì œëª© í•„ìš”"); newQuizzes.push({ id: Math.random().toString(36).substr(2, 9), folderId, title, questions: data }); }
          else throw new Error("í˜•ì‹ ì˜¤ë¥˜");
          window.DB.data.quizzes.push(...newQuizzes); window.DB.save(); document.getElementById('modal').classList.remove('active');
        } catch (e) { alert('ì˜¤ë¥˜: ' + e.message); }
      },

      selectAnswer(idx) { this.state.answers[this.state.qIndex] = idx; this.render(); },
      nextQuestion() {
        if (this.state.qIndex < this.state.currentQuiz.questions.length - 1) { this.state.qIndex++; this.render(); } 
        else { this.finishQuiz(); }
      },
      finishQuiz() {
        const quiz = this.state.currentQuiz;
        let correctCnt = 0;
        quiz.questions.forEach((q, i) => {
          const isCorrect = this.state.answers[i] === q.correct;
          if (isCorrect) correctCnt++;
          window.DB.data.results.push({ quizId: quiz.id, qId: q._originalIndex, correct: isCorrect, date: Date.now() });
        });
        window.DB.save();
        alert(`ì™„ë£Œ! ${correctCnt} / ${quiz.questions.length}`);
        this.goToList(quiz.folderId);
      },
      toggleReviewModeState(e) { this.state.reviewMode = e.target.checked; this.render(); },

      render() {
        const app = document.getElementById('app');
        if (!window.DB || !window.DB.data) { app.innerHTML = '<div class="empty-state">ë¡œë”© ì¤‘...</div>'; return; }
        const { view } = this.state;
        if (view === 'home') app.innerHTML = this.viewHome();
        else if (view === 'list') app.innerHTML = this.viewList();
        else if (view === 'quiz') app.innerHTML = this.viewQuiz();
      },

      viewHome() {
        const { folders, quizzes, results } = window.DB.data;
        const totalSolved = results?.length || 0;
        const totalCorrect = results?.filter(r => r.correct).length || 0;
        const accuracy = totalSolved ? Math.round((totalCorrect/totalSolved)*100) : 0;
        const themeIcon = this.state.isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™'; // ë‹¤í¬ëª¨ë“œë©´ í•´, ë¼ì´íŠ¸ë©´ ë‹¬ í‘œì‹œ

        return `
          <button onclick="window.App.toggleTheme()" class="theme-btn" title="ë‹¤í¬ ëª¨ë“œ ì „í™˜">${themeIcon}</button>

          <div class="header" style="flex-direction:column; align-items: flex-start; margin-top: 10px;">
            <h1 style="font-size:26px; font-weight:800; color:var(--text);">QuizFlow</h1>
            <p style="color:var(--sub); margin-top:4px;">${USER_KEY}ë‹˜ì˜ ì €ì¥ì†Œ</p>
          </div>

          <div class="stats-grid">
            <div class="stat-card"><div class="stat-val">${totalSolved}</div><div class="stat-label">í‘¼ ë¬¸ì œ</div></div>
            <div class="stat-card"><div class="stat-val">${totalCorrect}</div><div class="stat-label">ì •ë‹µ</div></div>
            <div class="stat-card"><div class="stat-val" style="color:${accuracy>=80 ? '#22c55e' : accuracy>=50 ? '#eab308' : '#ef4444'}">${accuracy}%</div><div class="stat-label">ì •ë‹µë¥ </div></div>
          </div>

          <div style="display:flex; gap:10px; margin-bottom:24px;">
            <button onclick="window.App.addQuizModal()" class="btn btn-primary" style="flex:1; padding:12px;">+ í€´ì¦ˆ ì¶”ê°€</button>
            <button onclick="window.App.addFolder()" class="btn" style="flex:1;">+ í´ë” ì¶”ê°€</button>
          </div>

          <div class="list-container">
            ${folders.map(f => {
              const count = quizzes.filter(q => q.folderId === f.id).length;
              return `<div class="list-item" onclick="window.App.goToList('${f.id}')">
                <div class="item-info"><h3>ğŸ“ ${f.name}</h3><p>í€´ì¦ˆ ${count}ê°œ</p></div>
                <div class="item-actions"><button onclick="window.App.renameFolder(event, '${f.id}')" class="btn-icon">âœ</button><button onclick="window.App.deleteFolder(event, '${f.id}')" class="btn-icon">ğŸ—‘</button></div>
              </div>`;
            }).join('')}
          </div>
        `;
      },

      viewList() {
        const fId = this.state.currentFolderId;
        const folder = window.DB.data.folders.find(f => f.id === fId);
        const folderQuizzes = window.DB.data.quizzes.filter(q => q.folderId === fId);
        const { reviewMode, selectMode, selectedQuizIds } = this.state;
        if (!folder) { this.goHome(); return ''; }

        return `
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
            <button onclick="window.App.goHome()" class="btn">â† ëª©ë¡</button>
            ${folderQuizzes.length > 0 ? `<button onclick="window.App.toggleSelectMode()" class="btn ${selectMode?'btn-primary':''}">${selectMode?'ì™„ë£Œ':'ì„ íƒ'}</button>`:''}
          </div>
          <div class="header" style="align-items:flex-end;">
            <div><h1 style="font-size:22px; font-weight:800;">${folder.name}</h1><p style="color:var(--sub); font-size:14px;">ì´ ${folderQuizzes.length}ê°œ</p></div>
            ${!selectMode ? `<div style="text-align:right;"><input type="checkbox" id="reviewToggle" class="toggle-input" ${reviewMode?'checked':''} onchange="window.App.toggleReviewModeState(event)"><label for="reviewToggle" class="toggle-wrapper"><span class="toggle-label" style="font-size:12px;">ì˜¤ë‹µ ë³µìŠµ</span><div class="toggle-switch"></div></label></div>` : ''}
          </div>
          <div class="list-container">
            ${folderQuizzes.length===0 ? '<div class="empty-state">í€´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.</div>' : ''}
            ${folderQuizzes.map(q => {
              const isSelected = selectedQuizIds.includes(q.id);
              return `<div class="list-item ${selectMode&&isSelected?'selected':''}" onclick="${selectMode?`window.App.toggleSelection('${q.id}')`:`window.App.startQuiz('${q.id}')`}">
                ${selectMode?`<div class="select-check"></div>`:''}
                <div class="item-info"><h3>ğŸ“ ${q.title}</h3><p>ë¬¸ì œ ${q.questions.length}ê°œ ${reviewMode?'<span style="color:var(--danger);font-size:11px;">(ì˜¤ë‹µ)</span>':''}</p></div>
                ${!selectMode?`<div class="item-actions" onclick="event.stopPropagation()"><button onclick="window.App.renameQuiz(event,'${q.id}')" class="btn-icon">âœ</button><button onclick="window.App.deleteQuiz(event,'${q.id}')" class="btn-icon">ğŸ—‘</button></div>`:''}
              </div>`;
            }).join('')}
          </div>
          <div class="bottom-bar ${selectMode&&selectedQuizIds.length>0?'active':''}"><span style="font-weight:600;">${selectedQuizIds.length}ê°œ ì„ íƒ</span><button onclick="window.App.mergeSelectedQuizzes()" class="btn btn-primary" style="border:none;">ë³‘í•©í•˜ê¸°</button></div>
        `;
      },

      viewQuiz() {
        const quiz = this.state.currentQuiz;
        const idx = this.state.qIndex;
        const q = quiz.questions[idx];
        const ua = this.state.answers[idx];
        const isAns = ua !== undefined;
        const progress = ((idx + 1) / quiz.questions.length) * 100;

        return `
          <div style="max-width:500px; margin:0 auto;">
            <div style="display:flex; justify-content:space-between; margin-bottom:12px; align-items:center;">
              <button onclick="window.App.goToList('${quiz.folderId}')" class="btn">âœ•</button>
              <div style="font-weight:700; color:var(--primary);">${quiz.isFiltered ? 'ğŸ”¥ ì˜¤ë‹µ ë³µìŠµ' : quiz.title}</div>
            </div>
            <div style="height:6px; background:var(--border); border-radius:3px; margin-bottom:20px; overflow:hidden;"><div style="height:100%; background:var(--primary); width:${progress}%; transition:width 0.3s;"></div></div>
            <div class="quiz-card">
              <span class="question-badge">Q ${idx + 1} / ${quiz.questions.length}</span>
              <h2 class="question-text">${q.q}</h2>
              <div style="display:flex; flex-direction:column; gap:8px;">
                ${q.options.map((opt, i) => {
                  let status = '';
                  if (isAns) { if (i===q.correct) status='correct'; else if (i===ua) status='wrong'; }
                  return `<button onclick="${!isAns?`window.App.selectAnswer(${i})`:''}" class="option-btn ${status}" ${isAns?'disabled':''}>${opt}</button>`;
                }).join('')}
              </div>
              ${isAns ? `<div style="margin-top:24px; padding-top:20px; border-top:1px solid var(--border); animation: fadeIn 0.3s;">
                <p style="margin-bottom:12px; font-weight:800; font-size:18px; color:${ua===q.correct?'#15803d':'#b91c1c'};">${ua===q.correct?'ğŸ‰ ì •ë‹µ!':'ğŸ¤” ì•„ì‰½ë„¤ìš”.'}</p>
                ${q.explanation?`<div style="font-size:14px; color:var(--sub); background:var(--bg); padding:12px; border-radius:8px; line-height:1.6;">ğŸ’¡ ${q.explanation}</div>`:''}
                <button onclick="window.App.nextQuestion()" class="btn btn-primary" style="width:100%; margin-top:16px; padding:14px; font-size:16px;">${idx<quiz.questions.length-1?'ë‹¤ìŒ ë¬¸ì œ':'ê²°ê³¼ ë³´ê¸°'}</button>
              </div>` : ''}
            </div>
          </div>
          <style>@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }</style>
        `;
      }
    };

    // ì´ˆê¸° ì‹¤í–‰ ë° í…Œë§ˆ ì ìš©
    window.addEventListener('DOMContentLoaded', async () => {
      // ì €ì¥ëœ í…Œë§ˆ ë¶ˆëŸ¬ì˜¤ê¸°
      if (window.App.state.isDarkMode) {
        document.body.classList.add('dark-mode');
      }
      await window.DB.load();
      window.App.render();
    });
  </script>
</body>
</html>
